console.log("CopilotX content script loaded");chrome.runtime.onMessage.addListener((n,t,e)=>{switch(console.log("Content script received message:",n),n.type){case"EXECUTE_BROWSER_TOOL":return l(n.toolCall).then(e).catch(r=>e({error:r.message})),!0;case"GET_PAGE_CONTEXT":const o=w();e({context:o});break;default:e({error:"Unknown message type"})}});async function l(n){const{name:t,arguments:e}=n;switch(t){case"browser_scrape":return m(e);case"browser_click":return d(e);case"browser_type":return f(e);case"browser_navigate":return g(e);default:throw new Error(`Unknown browser tool: ${t}`)}}function m(n){var r,i;const{selector:t,attribute:e,textOnly:o}=n;try{const c=document.querySelectorAll(t),s=[];for(const a of Array.from(c))e?s.push(a.getAttribute(e)):o?s.push((r=a.textContent)==null?void 0:r.trim()):s.push({text:(i=a.textContent)==null?void 0:i.trim(),html:a.innerHTML,tagName:a.tagName,attributes:Object.fromEntries(Array.from(a.attributes).map(u=>[u.name,u.value]))});return{success:!0,data:s,metadata:{executionTime:0}}}catch(c){return{success:!1,error:c instanceof Error?c.message:String(c),metadata:{executionTime:0}}}}function d(n){const{selector:t}=n;try{const e=document.querySelector(t);return e?(e.click(),{success:!0,data:{clicked:!0,element:t},metadata:{executionTime:0}}):{success:!1,error:`Element not found: ${t}`,metadata:{executionTime:0}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e),metadata:{executionTime:0}}}}function f(n){const{selector:t,text:e,clearFirst:o}=n;try{const r=document.querySelector(t);return r?(o&&(r.value=""),r.value=e,r.dispatchEvent(new Event("input",{bubbles:!0})),r.dispatchEvent(new Event("change",{bubbles:!0})),{success:!0,data:{typed:e,element:t},metadata:{executionTime:0}}):{success:!1,error:`Element not found: ${t}`,metadata:{executionTime:0}}}catch(r){return{success:!1,error:r instanceof Error?r.message:String(r),metadata:{executionTime:0}}}}function g(n){const{url:t}=n;try{return window.location.href=t,{success:!0,data:{navigated:!0,url:t},metadata:{executionTime:0}}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e),metadata:{executionTime:0}}}}function w(){return{url:window.location.href,title:document.title,domain:window.location.hostname,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}}}
